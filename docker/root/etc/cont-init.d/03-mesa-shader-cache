#!/usr/bin/with-contenv bash
set -euo pipefail

PUID="${PUID:-99}"
PGID="${PGID:-100}"

CACHE_DIR="${MESA_SHADER_CACHE_DIR:-/home/Tdarr/.cache/mesa_shader_cache}"
CACHE_PARENT="$(dirname "$CACHE_DIR")"

# Ensure parent + cache dir exist
mkdir -p "$CACHE_PARENT"
mkdir -p "$CACHE_DIR"

# Make cache parent writable by runtime user (abc) without touching all of /home/Tdarr
chown "$PUID:$PGID" "$CACHE_PARENT"
chmod 775 "$CACHE_PARENT"

# Ensure cache dir itself is writable too
chown "$PUID:$PGID" "$CACHE_DIR"
chmod 775 "$CACHE_DIR"
